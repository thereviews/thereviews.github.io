<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pose Test (2025)</title>
<style>
  body{ margin:0;background:#000;display:flex;justify-content:center;align-items:center;height:100vh; }
  video,canvas{ position:absolute; width:100vw;height:100vh;object-fit:cover;transform:scaleX(-1); }
  #msg{ position:absolute;top:10px;left:10px;padding:6px 10px;border-radius:6px;background:#0008;color:#fff;font-family:Arial; }
</style>
</head>
<body>

<video id="cam" autoplay playsinline muted></video>
<canvas id="cvs"></canvas>
<div id="msg">Loading model...</div>

<script type="module">
import { PoseLandmarker, FilesetResolver, DrawingUtils } 
from "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0";

const video = document.getElementById("cam");
const canvas = document.getElementById("cvs");
const ctx = canvas.getContext("2d");
const msg = document.getElementById("msg");

let landmarker;

async function initPose(){
  const vision = await FilesetResolver.forVisionTasks(
    "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0/wasm"
  );

  landmarker = await PoseLandmarker.createFromOptions(vision, {
    baseOptions:{
      modelAssetPath:"https://storage.googleapis.com/mediapipe-models/pose_landmarker/lite/float16/1/pose_landmarker_lite.task",
      delegate:"CPU"
    },
    runningMode:"VIDEO",
    numPoses:1
  });

  msg.textContent="Starting camera...";

  const stream = await navigator.mediaDevices.getUserMedia({ video:{ facingMode:"user" }});
  video.srcObject = stream;

  video.onloadedmetadata = ()=>{
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    requestAnimationFrame(trackPose);
  };
}

function trackPose(){
  const startTime = performance.now();
  const result = landmarker.detectForVideo(video,startTime);

  ctx.drawImage(video,0,0,canvas.width,canvas.height);

  if(result && result.landmarks.length>0){
    const utils = new DrawingUtils(ctx);
    utils.drawLandmarks(result.landmarks[0], {color:"#00FFFF",lineWidth:2,radius:3});
    utils.drawConnectors(result.landmarks[0], PoseLandmarker.POSE_CONNECTIONS, {color:"#FF00FF",lineWidth:2});

    msg.textContent = "Tracking... Move!";
    msg.style.background="rgba(0,150,0,0.7)";
  } else {
    msg.textContent = "Stand in frame!";
    msg.style.background="rgba(150,0,0,0.7)";
  }

  requestAnimationFrame(trackPose);
}

initPose();
</script>

</body>
</html>
