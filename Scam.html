<!DOCTYPE html>
<html>
<head>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body style="margin:0;background:black;color:white;text-align:center;">
<h3>Pose Test (Boxing)</h3>

<video id="video" style="display:none;"></video>
<canvas id="output" style="width:100vw;height:75vh;"></canvas>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("output");
const ctx = canvas.getContext("2d");

// Setup pose
const pose = new Pose.Pose({
  locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`
});
pose.setOptions({
  modelComplexity: 1,
  smoothLandmarks: true,
  enableSegmentation: false,
  minDetectionConfidence: 0.5,
  minTrackingConfidence: 0.5
});

pose.onResults(drawPose);

// Turn camera ON
navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" }, audio: false })
.then(function(stream) {
  video.srcObject = stream;
  video.play();
  const camera = new Camera(video, {
    onFrame: async () => { await pose.send({image: video}); }
  });
  camera.start();
});

// Draw results
function drawPose(results) {
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

  if (results.poseLandmarks) {
    results.poseLandmarks.forEach(p => {
      ctx.beginPath();
      ctx.arc(p.x * canvas.width, p.y * canvas.height, 6, 0, 2*Math.PI);
      ctx.fillStyle = "red";
      ctx.fill();
    });
  }
}
</script>
</body>
</html>
